---
import DiagramBox from './DiagramBox.astro';
import DiagramLine from './DiagramLine.astro';
import DiagramContainer from './DiagramContainer.astro';

interface Props {
  type: 'microservices' | 'monolith' | 'serverless' | 'mobile-backend';
}

const { type } = Astro.props;
---

<div class="w-full bg-slate-900/30 rounded-xl border border-slate-800 p-8 flex items-center justify-center min-h-[300px] relative overflow-hidden group">
    <!-- Background Grid -->
    <div class="absolute inset-0 bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:24px_24px]"></div>

    <!-- Diagram Implementation -->
    {type === 'mobile-backend' && (
         <div class="relative z-10 flex flex-col items-center gap-8 w-full max-w-4xl">
            <!-- Mobile Client -->
            <DiagramBox 
                label="App Mobile"
                width="20"
                height="10"
                color="slate"
                rounded="2xl"
                borderWidth="2"
                className="shadow-xl"
            />
            
            <!-- Connection Line to API Gateway -->
            <DiagramLine 
                direction="vertical"
                length="6"
                width="0.5"
                color="indigo"
                gradient={true}
                gradientFrom="slate"
                gradientTo="indigo"
            />
            
            <!-- API Gateway -->
            <div class="flex justify-center relative">
                <DiagramBox 
                    label="API Gateway"
                    color="indigo"
                    rounded="lg"
                    textSize="sm"
                    borderWidth="2"
                    className="px-8 py-4 font-mono shadow-lg relative z-10"
                />
            </div>
            
            <!-- Connection Lines Container - spans from API Gateway top to Services top -->
            <div class="relative w-full" style="height: 80px;">
                <svg class="absolute top-0 left-0 w-full h-full" style="pointer-events: none; overflow: visible; z-index: 5;">
                    <!-- Connection to Chat Service (column 1, center at ~12.5%) -->
                    <line 
                        x1="50%" 
                        y1="0" 
                        x2="12.5%" 
                        y2="100%" 
                        stroke="rgb(99, 102, 241)" 
                        stroke-width="2" 
                        opacity="0.6"
                        stroke-linecap="round"
                    />
                    
                    <!-- Connection to Feed Service (column 2, center at ~37.5%) -->
                    <line 
                        x1="50%" 
                        y1="0" 
                        x2="37.5%" 
                        y2="100%" 
                        stroke="rgb(99, 102, 241)" 
                        stroke-width="2" 
                        opacity="0.6"
                        stroke-linecap="round"
                    />
                    
                    <!-- Connection to User Account Service (column 3, center at ~62.5%) -->
                    <line 
                        x1="50%" 
                        y1="0" 
                        x2="62.5%" 
                        y2="100%" 
                        stroke="rgb(99, 102, 241)" 
                        stroke-width="2" 
                        opacity="0.6"
                        stroke-linecap="round"
                    />
                    
                    <!-- Connection to Recommendation Service (column 4, center at ~87.5%) -->
                    <line 
                        x1="50%" 
                        y1="0" 
                        x2="87.5%" 
                        y2="100%" 
                        stroke="rgb(99, 102, 241)" 
                        stroke-width="2" 
                        opacity="0.6"
                        stroke-linecap="round"
                    />
                </svg>
            </div>
            
            <!-- Microservices Grid -->
            <div class="w-full grid grid-cols-4 gap-4 items-start relative">
                <!-- Chat Service -->
                <div class="flex flex-col items-center gap-3">
                    <DiagramBox 
                        label="Chat Service"
                        color="sky"
                        rounded="lg"
                        textSize="xs"
                        borderWidth="2"
                        className="px-3 py-2 font-mono w-full text-center"
                    />
                </div>
                
                <!-- Feed Service -->
                <div class="flex flex-col items-center gap-3">
                    <DiagramBox 
                        label="Feed Service"
                        color="purple"
                        rounded="lg"
                        textSize="xs"
                        borderWidth="2"
                        className="px-3 py-2 font-mono w-full text-center"
                    />
                </div>
                
                <!-- User Account Service -->
                <div class="flex flex-col items-center gap-3">
                    <DiagramBox 
                        label="User Account"
                        color="amber"
                        rounded="lg"
                        textSize="xs"
                        borderWidth="2"
                        className="px-3 py-2 font-mono w-full text-center"
                    />
                </div>
                
                <!-- Recommendation Service -->
                <div class="flex flex-col items-center gap-3">
                    <DiagramBox 
                        label="Recommendation"
                        color="rose"
                        rounded="lg"
                        textSize="xs"
                        borderWidth="2"
                        className="px-3 py-2 font-mono w-full text-center"
                    />
                </div>
            </div>
            

            
            <!-- Database -->
            <div class="flex justify-center w-full mt-2">
                <DiagramBox 
                    label="Database"
                    color="emerald"
                    rounded="full"
                    textSize="sm"
                    borderWidth="2"
                    className="px-8 py-6 font-mono shadow-lg"
                />
            </div>
         </div>
    )}

    {type === 'monolith' && (
        <div class="relative z-10 flex items-center justify-center gap-8 w-full">
            <div class="flex flex-col items-center gap-2">
                <DiagramBox 
                    label="UI"
                    width="12"
                    height="12"
                    color="slate"
                    rounded="md"
                    shape="square"
                />
                <DiagramLine 
                    direction="vertical"
                    length="20"
                    width="1"
                    color="slate"
                    opacity="70"
                />
            </div>
            
            <DiagramContainer 
                label="Monolith"
                labelPosition="top-left"
                color="indigo"
                borderOpacity="50"
                rounded="xl"
                borderWidth="2"
                padding="md"
                gridCols={2}
                gap="md"
                className="shadow-2xl"
            >
                <DiagramBox 
                    label="Auth"
                    width="16"
                    height="16"
                    color="indigo"
                    rounded="md"
                    shape="square"
                    bgOpacity="20"
                    borderOpacity="30"
                    textSize="xs"
                />
                <DiagramBox 
                    label="Core"
                    width="16"
                    height="16"
                    color="indigo"
                    rounded="md"
                    shape="square"
                    bgOpacity="20"
                    borderOpacity="30"
                    textSize="xs"
                />
                <DiagramBox 
                    label="Data"
                    width="16"
                    height="16"
                    color="indigo"
                    rounded="md"
                    shape="square"
                    bgOpacity="20"
                    borderOpacity="30"
                    textSize="xs"
                />
                <DiagramBox 
                    label="Jobs"
                    width="16"
                    height="16"
                    color="indigo"
                    rounded="md"
                    shape="square"
                    bgOpacity="20"
                    borderOpacity="30"
                    textSize="xs"
                />
            </DiagramContainer>

            <div class="flex flex-col items-center gap-2">
                <DiagramLine 
                    direction="vertical"
                    length="20"
                    width="1"
                    color="slate"
                    opacity="70"
                />
                <DiagramBox 
                    label="DB"
                    color="emerald"
                    rounded="lg"
                    textSize="sm"
                    className="px-4 py-2 font-mono"
                />
            </div>
        </div>
    )}

    {(type === 'serverless' || type === 'microservices') && (
        <div class="relative z-10 grid grid-cols-3 gap-8 items-center w-full max-w-2xl px-8">
             <div class="flex flex-col gap-4">
                <DiagramBox 
                    label="Client A"
                    color="slate"
                    rounded="md"
                    textSize="xs"
                    className="p-3 text-center"
                />
                <DiagramBox 
                    label="Client B"
                    color="slate"
                    rounded="md"
                    textSize="xs"
                    className="p-3 text-center"
                />
             </div>

             <div class="flex flex-col items-center justify-center gap-2">
                <DiagramBox 
                    label="API GW"
                    width="12"
                    height="12"
                    color="indigo"
                    rounded="full"
                    shape="circle"
                    borderWidth="2"
                    textSize="xs"
                    className="text-center leading-tight"
                />
             </div>

             <div class="flex flex-col gap-6">
                <div class="flex items-center gap-2">
                    <DiagramLine 
                        direction="horizontal"
                        length="8"
                        width="0.5"
                        color="slate"
                        opacity="60"
                    />
                    <DiagramBox 
                        label="Auth Func"
                        color="sky"
                        rounded="md"
                        textSize="xs"
                        className="px-4 py-2"
                    />
                </div>
                <div class="flex items-center gap-2">
                    <DiagramLine 
                        direction="horizontal"
                        length="8"
                        width="0.5"
                        color="slate"
                        opacity="60"
                    />
                    <DiagramBox 
                        label="Game State"
                        color="purple"
                        rounded="md"
                        textSize="xs"
                        className="px-4 py-2"
                    />
                </div>
                <div class="flex items-center gap-2">
                    <DiagramLine 
                        direction="horizontal"
                        length="8"
                        width="0.5"
                        color="slate"
                        opacity="60"
                    />
                    <DiagramBox 
                        label="Payment"
                        color="emerald"
                        rounded="md"
                        textSize="xs"
                        className="px-4 py-2"
                    />
                </div>
             </div>
        </div>
    )}
</div>
