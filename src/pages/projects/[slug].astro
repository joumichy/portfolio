---
import Layout from "../../layouts/Layout.astro";
import Section from "../../components/ui/Section.astro";
import Button from "../../components/ui/Button.astro";
import Badge from "../../components/ui/Badge.astro";
import SystemArch from "../../components/diagrams/SystemArch.astro";
import UserFlow from "../../components/diagrams/UserFlow.astro";
import { projects } from "../../data/projects";

// Generate static paths for all projects
export async function getStaticPaths() {
    return projects.map((project) => ({
        params: { slug: project.slug },
        props: { project },
    }));
}

const { project } = Astro.props;
const baseUrl = import.meta.env.BASE_URL;
---

<Layout title={`${project.title} | John Allou Portfolio`}>
    <!-- Navbar Placeholder (Fixed navbar from Layout is visible) -->
    <div class="h-20"></div>

    <!-- Hero / Header -->
    <section class="relative py-20 bg-slate-900/30 border-b border-slate-800">
        <div class="container mx-auto px-4 relative z-10">
            <a
                href={`${baseUrl}#projects`}
                class="inline-flex items-center text-slate-400 hover:text-white mb-8 transition-colors"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="mr-2"><path d="m15 18-6-6 6-6"></path></svg
                >
                Back to Projects
            </a>

            <div class="flex gap-4 mb-6">
                {project.tags.map((tag) => <Badge text={tag} color="sky" />)}
            </div>

            <h1
                class="text-4xl md:text-5xl font-bold text-white mb-6 leading-tight"
            >
                {project.title}
            </h1>

            <p class="text-xl text-slate-300 max-w-3xl leading-relaxed mb-8">
                {project.longDescription}
            </p>

            <div class="flex flex-wrap gap-4">
                {project.tech.map((t) => <Badge text={t} color="indigo" />)}
            </div>
        </div>
    </section>

    <!-- Problem & Solution Grid -->
    <Section class="py-16">
        <div class="grid md:grid-cols-2 gap-12">
            <div
                class="bg-slate-900/20 p-8 rounded-2xl border border-red-500/10"
            >
                <h2
                    class="text-2xl font-bold text-white mb-4 flex items-center gap-2"
                >
                    <span class="text-red-400">Problem</span>
                </h2>
                <p class="text-slate-400 leading-relaxed">{project.problem}</p>
            </div>
            <div
                class="bg-slate-900/20 p-8 rounded-2xl border border-emerald-500/10"
            >
                <h2
                    class="text-2xl font-bold text-white mb-4 flex items-center gap-2"
                >
                    <span class="text-emerald-400">Solution</span>
                </h2>
                <p class="text-slate-400 leading-relaxed">{project.solution}</p>
            </div>
        </div>
    </Section>

    <!-- System Architecture -->
    <Section title="System Architecture" class="bg-slate-900/30">
        <div class="grid lg:grid-cols-3 gap-12">
            <div class="lg:col-span-1 space-y-6">
                <p class="text-slate-400 leading-relaxed text-lg">
                    {project.architecture.description}
                </p>
                <div
                    class="p-6 bg-slate-950 rounded-xl border border-slate-800"
                >
                    <h3 class="text-white font-bold mb-4">Key Features</h3>
                    <ul class="space-y-3">
                        {
                            project.features.map((feature) => (
                                <li class="flex items-start text-slate-400 text-sm">
                                    <svg
                                        class="w-5 h-5 text-indigo-500 mr-2 shrink-0"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                        stroke="currentColor"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M5 13l4 4L19 7"
                                        />
                                    </svg>
                                    {feature}
                                </li>
                            ))
                        }
                    </ul>
                </div>
            </div>
            <div class="lg:col-span-2">
                <SystemArch type={project.architecture.diagramType} />
                <div class="mt-4 text-center text-slate-500 text-sm font-mono">
                    Figure 1.0: {project.title} High-Level Architecture
                </div>
            </div>
        </div>
    </Section>

    <!-- User Flow -->
    <Section title="User Flow & Journey">
        <div class="grid lg:grid-cols-3 gap-12 items-start">
            <div class="lg:col-span-2">
                <UserFlow steps={project.userFlow.steps} />
            </div>
            <div class="lg:col-span-1 sticky top-24">
                <div
                    class="bg-gradient-to-br from-slate-900 to-slate-950 p-8 rounded-2xl border border-slate-800"
                >
                    <h3 class="text-xl font-bold text-white mb-4">
                        Flow Analysis
                    </h3>
                    <p class="text-slate-400 mb-6">
                        {project.userFlow.description}
                    </p>
                    <Button
                        href={`${baseUrl}#contact`}
                        variant="primary"
                        class="w-full justify-center"
                    >
                        Discuss this Project
                    </Button>
                </div>
            </div>
        </div>
    </Section>

    <!-- Navigation -->
    <div class="border-t border-slate-800 py-12">
        <div class="container mx-auto px-4 flex justify-between">
            <a
                href={`${baseUrl}#projects`}
                class="text-slate-400 hover:text-white transition-colors"
                >← Back to Projects</a
            >
            <a
                href={`${baseUrl}#contact`}
                class="text-indigo-400 hover:text-indigo-300 transition-colors"
                >Contact Me →</a
            >
        </div>
    </div>
</Layout>
